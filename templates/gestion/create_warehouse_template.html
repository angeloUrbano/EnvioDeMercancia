{% extends "index.html" %}
{% load static %}
{% block titulo %}<title> Registro</title>{% endblock titulo %}

{%block style %}
<style>
    /* Ocultar los contenedores de formularios por defecto */
    #formulario1-contenedor, #formulario2-contenedor, {
      display: none;
    }
    /* Ocultar los checkbox */
    #checkbox-contenedor {
      display: none;
    }
    #formulario3-contenedor {
      display: block;
    }
  </style>
{% endblock style %}

{% block contenido %}

<div  class="container-xxl flex-grow-1 container-p-y">
    <div class="row">
        <div class="col-md-12">
          <div class="d-flex justify-content-center">
            <div class="card mb-12">
              <h5 class="card-header">Buscar Cliente</h5>
              <div class="card-body  demo-vertical-spacing demo-only-element">
                  <!-- Campo de entrada y botón para mostrar los checkbox -->
                  <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="input-mostrar" 
                        placeholder="Persona o Empresa"
                        aria-label="Persona o Empresa"
                        aria-describedby="button-addon2"
                      />
                      <button class="btn btn-outline-primary" type="button" id="boton-mostrar">Buscar</button>
                    </div>
              </div>
          </div>
          </div>
           <!-- imformacion del cliente Existente -->
          <br>
          
          <div class="col-lg-6">
            <small class="text-light fw-semibold">Información del Cliente</small>
            <div class="demo-inline-spacing mt-3" id="lista-cliente"></div>
        </div>
        <br>
          <!-- formulario de Registro de Warehouse -->
          <br>
          <div id ="formulario3-contenedor">
            <div class="col-md">
                <div class="card mb-6">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Warehouse</h5>
                        <small class="text-muted float-end">
                          <div class="col-lg-2 col-md-3">        
                            <div class="mt-3">
                            <button
                              type="button"
                              data-bs-toggle="offcanvas"
                              data-bs-target="#offcanvasBoth"
                              aria-controls="offcanvasBoth"
                              style="border: none; background: transparent; padding: 0;"
                            >
                            <img src="{% static 'assets/img/favicon/received.png' %}" alt="Registrado" style="width: 50px; height: auto;" />
                          </button>
                              <div
                                class="offcanvas offcanvas-end"
                                data-bs-scroll="true"
                                tabindex="-1"
                                id="offcanvasBoth"
                                aria-labelledby="offcanvasBothLabel"
                              >
                                <div class="offcanvas-header">
                                  <h5 id="offcanvasBothLabel" class="offcanvas-title">Cantidad de Registro Warehouse</h5>
                                  <button
                                    type="button"
                                    class="btn-close text-reset"
                                    data-bs-dismiss="offcanvas"
                                    aria-label="Close"
                                  ></button>
                                </div>
                                <div class="offcanvas-body my-auto mx-0 flex-grow-0">
                                  <p class="text-center">
                                     formulario formulario1  formulario formulario1  formulario formulario1 formulario formulario1
                                     formulario formulario1 formulario formulario1 formulario formulario1
                                     formulario formulario1 formulario formulario1 formulario formulario1
                                     formulario formulario1 formulario formulario1 formulario formulario1
                                  </p>
                                  <button type="button" class="btn btn-primary mb-2 d-grid w-100">Enviar</button>
                                  <button
                                    type="button"
                                    class="btn btn-outline-secondary d-grid w-100"
                                    data-bs-dismiss="offcanvas"
                                  >
                                    Cancelar
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </small>
                    </div>
                    <div class="card-body  demo-vertical-spacing demo-only-element">
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label" for="basic-icon-default-fullname">Shipper</label>
                                <div class="input-group input-group-merge">
                                    <select class="form-control" name="shipper" id="shipper">
                                        <option value="1">Prueba 1</option>
                                        <option value="2">Prueba 2</option>
                                        <option value="3">Prueba 3</option>
                                        <option value="4">Prueba 4</option>
                                        <option value="5">Prueba 5</option>
                                    </select>
                                  </div>
                            </div>
                            <div class="col-6">
                                <label class="form-label" for="basic-icon-default-fullname">Recibido de:</label>
                                <div class="input-group input-group-merge">
                                    <select class="form-control" name="recibido_de" id="recibido_de">
                                        <option value="1">Prueba 1</option>
                                        <option value="2">Prueba 2</option>
                                        <option value="3">Prueba 3</option>
                                        <option value="4">Prueba 4</option>
                                        <option value="5">Prueba 5</option>
                                    </select>
                                  </div>
                            </div>
                        </div>
                        <HR></HR>
                        <br>
                        <div class="row">
                            <div class="col-2">
                                <label class="form-label" for="basic-icon-default-company">Ancho</label>
                                <div class="input-group input-group-merge">
                                  <span id="basic-icon-default-company2" class="input-group-text"
                                    ><i class="bx bx-buildings"></i
                                  ></span>
                                  <input
                                    type="text"
                                    id="ancho"
                                    class="form-control"
                                    placeholder="1.20"
                                    aria-label="1.20"
                                    aria-describedby="basic-icon-default-company2"
                                  />
                                </div>
                            </div>
                            <div class="col-2">
                                <label class="form-label" for="basic-icon-default-company">Alto</label>
                                <div class="input-group input-group-merge">
                                  <span id="basic-icon-default-company2" class="input-group-text"
                                    ><i class="bx bx-buildings"></i
                                  ></span>
                                  <input
                                    type="text"
                                    id="alto"
                                    class="form-control"
                                    placeholder="1.20"
                                    aria-label="1.20"
                                    aria-describedby="basic-icon-default-company2"
                                  />
                                </div>    
                            </div>
                            <div class="col-2">
                                <label class="form-label" for="basic-icon-default-company">Prof.</label>
                                <div class="input-group input-group-merge">
                                  <span id="basic-icon-default-company2" class="input-group-text"
                                    ><i class="bx bx-buildings"></i
                                  ></span>
                                  <input
                                    type="text"
                                    id="Profu"
                                    class="form-control"
                                    placeholder="1.20"
                                    aria-label="1.20"
                                    aria-describedby="basic-icon-default-company2"
                                  />
                                </div>    
                            </div>
                            <div class="col-2">
                                <label class="form-label" for="basic-icon-default-company">pvol</label>
                                    <p>0</p>
                                </div>
                                <div class="col-2">
                                    <label class="form-label" for="basic-icon-default-company">m3</label>
                                        <p>0</p>
                                    </div>
                                    <div class="col-2">
                                        <label class="form-label" for="basic-icon-default-company">p3</label>
                                            <p>0</p>
                                        </div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label class="form-label" for="basic-icon-default-company">Tracking no.</label>
                                <div class="input-group input-group-merge">
                                  <span id="basic-icon-default-company2" class="input-group-text"
                                    ><i class="bx bx-buildings"></i
                                  ></span>
                                  <input
                                    type="text"
                                    id="Tracking"
                                    class="form-control"
                                    placeholder="1.20"
                                    aria-label="1.20"
                                    aria-describedby="basic-icon-default-company2"
                                  />
                                </div>    
                            </div>
                            <div class="col-3">
                                <label class="form-label" for="basic-icon-default-company">contenido</label>
                                <div class="input-group input-group-merge">
                                  <span id="basic-icon-default-company2" class="input-group-text"
                                    ><i class="bx bx-buildings"></i
                                  ></span>
                                  <input
                                    type="text"
                                    id="contenido"
                                    class="form-control"
                                    placeholder="1.20"
                                    aria-label="1.20"
                                    aria-describedby="basic-icon-default-company2"
                                  />
                                </div>    
                            </div>
                            <div class="col-3">
                                <label class="form-label" for="basic-icon-default-company">valor $.</label>
                                <div class="input-group input-group-merge">
                                  <span id="basic-icon-default-company2" class="input-group-text"
                                    ><i class="bx bx-buildings"></i
                                  ></span>
                                  <input
                                    type="text"
                                    id="valor"
                                    class="form-control"
                                    placeholder="1.20"
                                    aria-label="1.20"
                                    aria-describedby="basic-icon-default-company2"
                                  />
                                </div>    
                            </div>
                            <div class="col-3">
                              <label class="form-label" for="basic-icon-default-company">  <br> </label> 
                                <div class="input-group input-group-merge">
                                  <button                
                                      type="button" 
                                      style="border: none; background: transparent; padding: 0;"
                                  >
                                      <img src="{% static 'assets/img/favicon/delete.png' %}" alt="Borrar" style="width: 44px; height: auto;" />
                                  </button>
                              </div>    

                             
                            </div>
                            
                        </div>
                        <div class="row">
                            <label class="form-label" for="basic-icon-default-company">comentario</label>
                                <div class="input-group input-group-merge">
                                  <textarea class="form-control" name="comentario" id="comentario" cols="4" rows="3"></textarea>
                                </div>    
                        </div>
                        <div class="row">
                          <label class="form-label" for="basic-icon-default-company">Observacion</label>
                              <div class="input-group input-group-merge">
                                <textarea class="form-control" name="observacion" id="observacion" cols="4" rows="3"></textarea>
                              </div>    
                      </div>
                    </div>
                    <div class="card-footer">
                        <div class="row">
                          <div class="col-6">
                            <button
                                type="button"
                                style="border: none; background: transparent; padding: 0;"
                            >
                                <img src="{% static 'assets/img/favicon/add-to-cart.png' %}" alt="registro" style="width: 50px; height: auto;" />
                            </button>
                        </div>
                            {% comment %} <div class="col-2">
                                <button class="btn btn-primary">Guardar</button>
                            </div> {% endcomment %}
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
          <br>
          <br>
        <!-- Registra de cliente no Existente -->
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="col-md-8">
                  <div class="card mb-6">
                      <div  class="caud-body demo-vertical-spacing demo-only-element">
                          <div id="checkbox-contenedor">
                            <div class="d-flex justify-content-center">
                              <div class="mb-3">
                                <div class="form-check form-control-sm footer-link me-3">
                                    <input class="form-check-input" type="checkbox"  id="formulario1-casilla" />
                                    <label class="form-check-label" for="formulario1-casilla"> Cliente Natural </label>
                                  </div>
                                  <div class="form-check form-control-sm footer-link me-3">
                                    <input class="form-check-input" type="checkbox"  id="formulario2-casilla" />
                                    <label class="form-check-label" for="formulario2-casilla"> Cliente Ejecutivo </label>
                                  </div>
                            </div>       
                              </div>
                              <div id ="formulario1-contenedor" >
                                  <form action="" id="formulario1">
                                       <div class="row">
                                          <div class="col-xl">
                                              <div class="card mb-4">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                  <h5 class="mb-0">Cliente Natural</h5>
                                                  <small class="text-muted float-end">Registro datos personales</small>
                                                </div>
                                                <div class="card-body">
                                                  <form>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-fullname">Nombres</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-fullname2" class="input-group-text"
                                                          ><i class="bx bx-user"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="nombre"
                                                          class="form-control"
                                                          id="basic-icon-default-fullname"
                                                          placeholder="John Doe"
                                                          aria-label="John Doe"
                                                          aria-describedby="basic-icon-default-fullname2"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-fullname">Apellido</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-fullname2" class="input-group-text"
                                                          ><i class="bx bx-user"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="Apellido"
                                                          class="form-control"
                                                          id="basic-icon-default-fullname"
                                                          placeholder="John Doe"
                                                          aria-label="John Doe"
                                                          aria-describedby="basic-icon-default-fullname2"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-fullname">cedula</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-fullname2" class="input-group-text"
                                                          ><i class="bx bx-user"></i
         ></span>
                                                        <input
                                                          type="text"
                                                          id="cedula"
                                                          class="form-control"
                                                          id="basic-icon-default-fullname"
                                                          placeholder="John Doe"
                                                          aria-label="John Doe"
                                                          aria-describedby="basic-icon-default-fullname2"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-email">Email</label>
                                                      <div class="input-group input-group-merge">
                                                        <span class="input-group-text"><i class="bx bx-envelope"></i></span>
                                                        <input
                                                          type="text"
                                                          id="correo"
                                                          class="form-control"
                                                          placeholder="john.doe"
                                                          aria-label="john.doe"
                                                          aria-describedby="basic-icon-default-email2"
                                                        />
                                                        <span id="basic-icon-default-email2" class="input-group-text">@example.com</span>
                                                      </div>
                                                      <div class="form-text">You can use letters, numbers & periods</div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-email">Email axiliar</label>
                                                      <div class="input-group input-group-merge">
                                                        <span class="input-group-text"><i class="bx bx-envelope"></i></span>
                                                        <input
                                                          type="text"
                                                          id="correo_axi"
                                                          class="form-control"
                                                          placeholder="john.doe"
                                                          aria-label="john.doe"
                                                          aria-describedby="basic-icon-default-email2"
                                                        />
                                                        <span id="basic-icon-default-email2" class="input-group-text">@example.com</span>
                                                      </div>
                                                      <div class="form-text">You can use letters, numbers & periods</div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-phone">Telefono</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-phone2" class="input-group-text"
                                                          ><i class="bx bx-phone"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="telefono"
                                                          class="form-control phone-mask"
                                                          placeholder="658 799 8941"
                                                          aria-label="658 799 8941"
                                                          aria-describedby="basic-icon-default-phone2"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-phone">Telefono Personal</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-phone2" class="input-group-text"
                                                          ><i class="bx bx-phone"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="telefono_axi"
                                                          class="form-control phone-mask"
                                                          placeholder="658 799 8941"
                                                          aria-label="658 799 8941"
                                                          aria-describedby="basic-icon-default-phone2"
                                                        />
                                                      </div>
                                                    </div>
                                                    <button type="submit" id="enviar-formulario1" class="btn btn-primary">Enviar</button>
                                                  </form>
                                                </div>
                                              </div>
                                            </div>
                                       </div>
                                  </form>
                              </div>
                              <div id="formulario2-contenedor">
                                  <form id="formulario2">
                                      <div class="col-xl">
                                          <div class="card mb-4">
                                          <div class="card-header d-flex justify-content-between align-items-center">
                                              <h5 class="mb-0">Cliente Ejecutivo</h5>
                                              <small class="text-muted float-end">Datos de la Compañia</small>
                                          </div>
                                            <div class="card-body">
                                              <form>
                                                  <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-company">Empresa</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-company2" class="input-group-text"
                                                          ><i class="bx bx-buildings"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="nombre_e"
                                                          class="form-control"
                                                          placeholder="ACME Inc."
                                                          aria-label="ACME Inc."
                                                          aria-describedby="basic-icon-default-company2"
                                                        />
                                                      </div>
                                                  </div>
                                                  <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-company">RIF</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-company2" class="input-group-text"
                                                          ><i class="bx bx-buildings"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="rif"
                                                          class="form-control"
                                                          placeholder="ACME Inc."
                                                          aria-label="ACME Inc."
                                                          aria-describedby="basic-icon-default-company2"
                                                        />
                                                      </div>
                                                  </div>
                                                  <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-email">Email Corporativo</label>
                                                      <div class="input-group input-group-merge">
                                                        <span class="input-group-text"><i class="bx bx-envelope"></i></span>
                                                        <input
                                                          type="text"
                                                          id="correo_corp"
                                                          class="form-control"
                                                          placeholder="john.doe"
                                                          aria-label="john.doe"
                                                          aria-describedby="basic-icon-default-email2"
                                                        />
                                                        <span id="basic-icon-default-email2" class="input-group-text">@example.com</span>
                                                      </div>
                                                      <div class="form-text">You can use letters, numbers & periods</div>
                                                    </div>
                                                    <div class="mb-3">
                                                      <label class="form-label" for="basic-icon-default-phone">Telefono Corporativo</label>
                                                      <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-phone2" class="input-group-text"
                                                          ><i class="bx bx-phone"></i
                                                        ></span>
                                                        <input
                                                          type="text"
                                                          id="telefono_corp"
                                                          class="form-control phone-mask"
                                                          placeholder="658 799 8941"
                                                          aria-label="658 799 8941"
                                                          aria-describedby="basic-icon-default-phone2"
                                                        />
                                                      </div>
                                                    </div>
                                              
                                                <button type="submit" id="enviar-formulario2" class="btn btn-primary">Enviar</button>
                                                
                                              </form>
                                            </div>
                                          </div>
                                        </div>
                                  </form>
                            </div>
                            
                      </div>
                  </div>
              </div>
              </div>
                
            </div>
        </div>
          
        </div>
    </div> 
</div>
<script>
  // ......................................peticion  buscar Cliente...............................................
  var currentBuscarClienteUrl = "{% url 'gestionurls:buscarcliente' %}";
  console.log(currentBuscarClienteUrl)

  const botonSubmit = document.querySelector("#boton-mostrar")
  async function buscarCliente(currentBuscarClienteUrl) {

  const inputValue = document.getElementById('input-mostrar').value;
  console.log(inputValue)
  const opciones = {
    method: 'POST',
    headers: {
      'X-Requested-With': 'XMLHttpRequest',
      'X-CSRFToken': '{{ csrf_token }}',
      'Content-Type': 'application/x-www-form-urlencoded' // Agrega este header
    },
    body: new URLSearchParams({
      q: inputValue
    })
  };

  let res =  await fetch(currentBuscarClienteUrl, opciones)
  let transformarToJson = await res.json()

  if (res.ok) {
    const checkboxContenedor = document.getElementById('checkbox-contenedor');
    const formulario3Contenedor = document.getElementById('formulario3-contenedor');
    const listaCliente = document.getElementById('lista-cliente'); // Asegúrate de tener este elemento en tu HTML

    checkboxContenedor.style.display = 'none'; // Establece el estilo display en none por defecto
    listaCliente.innerHTML = ''; // Limpiar contenido previo

    if (transformarToJson && typeof transformarToJson === 'object') {
        if (transformarToJson.mensaje === "El Cliente no Existe") {
            if (confirm("El Cliente no Existe. ¿Desea crear nuevo Cliente?")) {
                console.log("Proceso de creación de cliente");
                checkboxContenedor.style.display = 'block'; // Cambia el estilo display a block si se ha confirmado
                formulario3Contenedor.style.display = 'none';
            } else {
                console.log("Cancelar");
            }
        } else {
            console.log("Existe el Cliente");
            console.log(transformarToJson);

            // Obtener los datos del cliente
            const cliente = transformarToJson.datos_cliente; // Accediendo a datos_cliente

            if (cliente && typeof cliente === 'object') {
                // Crear un contenedor para las columnas
                const row = document.createElement('div');
                row.classList.add('row'); // Clase de Bootstrap para filas

                // Crear la primera columna
                const col1 = document.createElement('div');
                col1.classList.add('col-md-6'); // Clase para columnas de Bootstrap

                const ul1 = document.createElement('ul');
                ul1.classList.add('list-group'); // Clase de Bootstrap para listas

                // Elementos de lista para la primera columna
                const nombreLi = document.createElement('li');
                nombreLi.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center', 'border-0'); // Sin borde
                nombreLi.innerHTML = `Nombre: ${cliente.nombre}`;
                ul1.appendChild(nombreLi);

                const cedulaLi = document.createElement('li');
                cedulaLi.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center', 'border-0');
                cedulaLi.innerHTML = `Identidad: ${cliente.cedula}`;
                ul1.appendChild(cedulaLi);

                col1.appendChild(ul1);
                row.appendChild(col1);

                // Crear la segunda columna
                const col2 = document.createElement('div');
                col2.classList.add('col-md-6'); // Clase para columnas de Bootstrap

                const ul2 = document.createElement('ul');
                ul2.classList.add('list-group'); // Clase de Bootstrap para listas

                // Elementos de lista para la segunda columna
                const correoLi = document.createElement('li');
                correoLi.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center', 'border-0');
                correoLi.innerHTML = `Correo: ${cliente.correo}`;
                ul2.appendChild(correoLi);

                const telefonoLi = document.createElement('li');
                telefonoLi.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center', 'border-0');
                telefonoLi.innerHTML = `Teléfono: ${cliente.telefono}`;
                ul2.appendChild(telefonoLi);

                col2.appendChild(ul2);
                row.appendChild(col2);

                // Agregar la fila de columnas al contenedor de la lista de cliente
                listaCliente.appendChild(row);
            } else {
                console.error("El cliente no es un objeto válido");
            }
        }
    } else {
        console.error("transformarToJson no está definido o no es un objeto");
    }
}else{
      alert("error en el envio de formulario")
  }
}

botonSubmit.addEventListener('click', function() {
  buscarCliente(currentBuscarClienteUrl)
});

</script>
<script>
  // Pasar la URL de Django a JavaScript
  const currentBuscarClienteUrl = "{% url 'gestionurls:buscarcliente' %}";

</script>
<script src="{% static 'js/registro_cliente.js' %}"></script>


{% endblock contenido %}
 